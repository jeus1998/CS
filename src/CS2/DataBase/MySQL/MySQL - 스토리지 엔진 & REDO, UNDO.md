# MySQL - 스토리지 엔진 & REDO, UNDO

### MySQL 엔진?

- 데이터 저장 및 처리 방식을 결정 
- 데이터베이스 관리 시스템(DBMS)의 핵심 구성 요소 
- 여러가지 스토리지 엔진 지원 
- 각 스토리지 엔진은 데이터의 저장, 검색, 업데이트 방식을 다르게 처리
- 특정 기능과 성능 특성을 가진다

### MySQL 엔진 종류 

- InnoDB
  - 트랜잭션 지원(ACID)준수 
  - FK 지원
  - 자동 크래시 복구
  - 높은 동시성 처리
  - 행 수준 잠금(Row-level locking)
  - 용도: 데이터의 일관성과 무결성이 중요한 트랜잭션 중심의 애플리케이션에서 사용 
- MyISAM
  - 트랜잭션 미지원 
  - FK 미지원 
  - 전체 텍스트 검색 기능 제공 
  - 테이블 수준 잠금(Table-level locking)
  - 상대적으로 빠른 읽기 성능 
  - 용도: 읽기 위주의 애플리케이션에서 주로 사용 
- MEMORY
  - 데이터를 메모리에 저장
  - 매우 빠른 데이터 접근 속도
  - 휘발성(서버가 재시작되면 데이터가 사라짐)
  - 테이블 수준 잠금(Table-level locking)
  - 용도: 임시 데이터 저장 및 빠른 데이터 접근이 필요한 상황에서 주로 사용
- MERGE
  - 여러 MyISAM 테이블을 하나의 테이블처럼 다룸
  - 단일 테이블로 대용량 데이터 처리 가능
  - 용도: 분할된 데이터 처리가 필요한 대규모 데이터베이스에서 주로 사용
- CSV
  - 데이터를 CSV(Comma-Separated Values) 형식으로 저장
  - 외부 애플리케이션과의 데이터 교환이 용이
  - 용도: 다른 시스템과의 데이터 교환이 필요한 경우 사용
- ARCHIVE
  - 압축된 형태로 데이터 저장
  - 읽기와 삽입만 가능(업데이트와 삭제는 불가능)
  - 저렴한 저장 공간 사용
  - 용도: 대용량 로그 및 감사 데이터 저장에 주로 사용
- NDB (Clustered)
  - MySQL 클러스터를 위한 엔진
  - 고가용성과 분산 저장을 지원
  - 데이터 노드 간의 자동 분산과 복제
  - 용도: 고가용성과 확장성이 필요한 분산 데이터베이스에서 주로 사용

### UNDO(롤백) & REDO(재실행)

UNDO(롤백)
- UNDO는 트랜잭션이 실패하거나 롤백될 때 변경된 데이터를 이전 상태로 되돌리는 메커니즘
- 이를 통해 데이터베이스는 트랜잭션이 시작되기 전의 일관된 상태로 복구
- 작동 원리
  - 트랜잭션이 데이터를 변경하면, 변경되기 전의 데이터 값을 UNDO 로그에 기록
  - 트랜잭션이 롤백될 때, UNDO 로그를 사용하여 변경된 데이터를 원래 값으로 복원
- 예시
  - 트랜잭션 A가 데이터베이스의 값 X를 10에서 20으로 변경 시도
  - 트랜잭션 A는 변경 전에 UNDO 로그에 원래 값 10을 기록
  - 트랜잭션 A가 실패하면, 데이터베이스는 UNDO 로그를 사용하여 값 X를 10으로 복원

REDO(재실행)
- REDO는 데이터베이스 시스템이 충돌이나 장애로부터 복구될 때, 완료된 트랜잭션의 변경 사항을 다시 적용하는 메커니즘
- 이를 통해 데이터베이스는 충돌 전의 일관된 상태로 복원
- 작동 원리
  - 트랜잭션이 커밋되면, 변경된 데이터 값을 REDO 로그에 기록
  - 시스템 충돌이 발생하고 다시 시작될 때, REDO 로그를 사용하여 커밋된 트랜잭션의 모든 변경 사항을 다시 적용
- 예시
  - 트랜잭션 B가 데이터베이스의 값 Y를 30에서 40으로 변경하고 커밋
  - 트랜잭션 B는 변경 후에 REDO 로그에 새로운 값 40을 기록
  - 시스템이 충돌하고 다시 시작될 때, 데이터베이스는 REDO 로그를 사용하여 값 Y를 40으로 재설정 

### 데이터베이스 복구 과정

데이터베이스 시스템은 충돌이나 장애 발생 시 UNDO와 REDO 메커니즘을 결합하여 복구 과정을 수행

순서
1. 분석 단계: 충돌 시점의 상태를 파악하고, 어떤 트랜잭션이 커밋되었는지, 어떤 트랜잭션이 진행 중이었는지 확인
2. UNDO 단계: 진행 중이었던 트랜잭션의 변경 사항을 롤백하여 데이터베이스를 일관된 상태로 복원
   UNDO 로그를 사용하여 변경된 데이터를 원래 상태로 복원
3. REDO 단계: 커밋된 트랜잭션의 변경 사항을 다시 적용하여 데이터베이스를 충돌 전의 상태로 복원
   REDO 로그를 사용하여 커밋된 트랜잭션의 변경 사항을 다시 적용

이러한 UNDO와 REDO 메커니즘을 통해 데이터베이스 시스템은 충돌이나 장애 발생 시 데이터의 일관성과 무결성을 유지